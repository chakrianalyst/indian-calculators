<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Scenario Calculator (Vanilla JS)</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body class="min-h-screen bg-gradient">
    <div class="main-container">
        <h1 class="title">Financial Scenario Calculator</h1>

        <section class="section-description">
            <h2 class="section-title-welcome">Welcome to the Financial Scenario Calculator!</h2>
            <p>This tool helps you analyze the financial performance of an asset investment, considering purchase, financing (loans), ongoing income (rent), recurring expenses, taxation, and eventual sale. Fill in the details below to get a comprehensive summary of your cash flows, profit/loss (Nominal & Real), and the annualized return (XIRR).</p>
            <ul class="list-disc-styled">
                <li><span class="font-semibold text-blue-700">Asset Purchase Details:</span> Enter when and for how much you acquired the asset.</li>
                <li><span class="font-semibold text-green-700">Loan Details:</span> If you used a loan, specify its terms and current status to generate an amortization schedule.</li>
                <li><span class="font-semibold text-yellow-700">Rental / Saved Rent Income:</span> Include any regular income generated by the asset or rent saved by occupying it. You can specify annual increases.</li>
                 <li><span class="font-semibold text-orange-700">Recurring Expenses:</span> Account for regular costs like property tax or maintenance.</li>
                <li><span class="font-semibold text-red-700">Taxation Details:</span> Directly enter the estimated capital gains tax you expect to pay.</li>
                <li><span class="font-semibold text-gray-700">Inflation Details:</span> Specify an inflation rate to view real (inflation-adjusted) returns.</li>
                <li><span class="font-semibold text-purple-700">Asset Sale Details:</span> Provide the planned or actual date and price of selling the asset.</li>
            </ul>
            <p class="text-sm-note">All your inputs are automatically saved in your browser. Hover over any input field for a brief description.</p>
        </section>

        <div id="errorMessage" class="error-message hidden" role="alert">
            <strong class="font-bold">Error! </strong>
            <span id="errorMessageText" class="block sm:inline"></span>
        </div>

        <section class="section-container blue-border">
            <h2 class="section-title blue-text">Asset Purchase Details</h2>
            <div class="grid-2-cols">
                <div>
                    <label for="purchaseDate" class="label-text">Purchase Date:</label>
                    <input type="date" id="purchaseDate" class="input-field" title="The date you acquired the asset (e.g., house, plot, shares).">
                </div>
                <div>
                    <label for="purchasePrice" class="label-text">Purchase Price (₹):</label>
                    <input type="number" id="purchasePrice" class="input-field" placeholder="e.g., 10000000 (1 Crore)" title="The total price paid for the asset in Indian Rupees.">
                </div>
            </div>
        </section>

        <section class="section-container green-border">
            <h2 class="section-title green-text">Loan Details</h2>
            <div class="mb-4">
                <span class="label-text">Loan Taken?</span>
                <div class="radio-group">
                    <label class="radio-label" title="Select if you took a loan for this asset.">
                        <input type="radio" name="loanTaken" value="yes" class="form-radio">
                        <span class="ml-2">Yes</span>
                    </label>
                    <label class="radio-label" title="Select if you did not take a loan for this asset.">
                        <input type="radio" name="loanTaken" value="no" class="form-radio" checked>
                        <span class="ml-2">No</span>
                    </label>
                </div>
            </div>

            <div id="loanDetailsSection" class="hidden">
                <div class="grid-2-cols mb-4">
                    <div>
                        <label for="loanPrincipal" class="label-text">Loan Principal (₹):</label>
                        <input type="number" id="loanPrincipal" class="input-field" placeholder="e.g., 8000000 (80 Lakhs)" title="The initial principal amount of the loan taken for the asset.">
                    </div>
                    <div>
                        <label for="loanAnnualRate" class="label-text">Annual Interest Rate (%):</label>
                        <input type="number" id="loanAnnualRate" class="input-field" placeholder="e.g., 5.5" title="The annual interest rate of the loan in percentage.">
                    </div>
                    <div>
                        <label for="loanStartDate" class="label-text">Loan Start Date:</label>
                        <input type="date" id="loanStartDate" class="input-field" title="The date when the loan payments began.">
                    </div>
                    <div>
                        <label for="loanTermMonths" class="label-text">Loan Term (Months):</label>
                        <input type="number" id="loanTermMonths" class="input-field" placeholder="e.g., 180 (for 15 years)" title="The total duration of the loan in months.">
                    </div>
                </div>

                <div class="mb-4">
                    <span class="label-text">Loan Status:</span>
                    <div class="radio-group">
                        <label class="radio-label" title="Select if the loan has been fully repaid before the asset sale.">
                            <input type="radio" name="loanStatus" value="closed" class="form-radio">
                            <span class="ml-2">Closed</span>
                        </label>
                        <label class="radio-label" title="Select if the loan is still active until the asset sale date.">
                            <input type="radio" name="loanStatus" value="running" class="form-radio" checked>
                            <span class="ml-2">Running</span>
                        </label>
                    </div>
                </div>

                <div id="loanEndDateContainer" class="flex-align-center gap-2 hidden">
                    <label for="loanEndDate" class="label-text">Loan End Date:</label>
                    <input type="date" id="loanEndDate" class="input-field-flex" title="The date when the loan was fully repaid.">
                    <label class="checkbox-label">
                        <input type="checkbox" id="isLoanEndDateToday" class="form-checkbox">
                        <span class="ml-1">Select Today</span>
                    </label>
                </div>
            </div>
        </section>

        <section class="section-container yellow-border">
            <h2 class="section-title yellow-text">Rental / Saved Rent Income</h2>
            <div class="mb-4">
                <span class="label-text">Did you receive rent or save rent?</span>
                <div class="radio-group">
                    <label class="radio-label" title="Select if the asset generates regular income (e.g., rent from tenants).">
                        <input type="radio" name="hasRentalIncome" value="yes" class="form-radio">
                        <span class="ml-2">Yes</span>
                    </label>
                    <label class="radio-label" title="Select if the asset does not generate regular income.">
                        <input type="radio" name="hasRentalIncome" value="no" class="form-radio" checked>
                        <span class="ml-2">No</span>
                    </label>
                </div>
            </div>

            <div id="rentalDetailsSection" class="hidden">
                <div class="mb-4">
                    <span class="label-text">Type of Income:</span>
                    <div class="radio-group">
                        <label class="radio-label" title="Select if you receive rent from tenants.">
                            <input type="radio" name="rentalType" value="received" class="form-radio" checked>
                            <span class="ml-2">Rent Received</span>
                        </label>
                        <label class="radio-label" title="Select if you reside in the asset and save on rent.">
                            <input type="radio" name="rentalType" value="saved" class="form-radio">
                            <span class="ml-2">Rent Saved (from staying in asset)</span>
                        </label>
                    </div>
                </div>

                <div class="grid-2-cols mb-4">
                    <div>
                        <label for="rentalAmount" class="label-text">Monthly Amount (₹):</label>
                        <input type="number" id="rentalAmount" class="input-field" placeholder="e.g., 50000" title="The regular monthly amount of rent received or saved.">
                    </div>
                    <div>
                        <label for="rentalStartDate" class="label-text">Start Date:</label>
                        <input type="date" id="rentalStartDate" class="input-field" title="The date when rental income/saving began.">
                    </div>
                    <div class="flex-align-center gap-2">
                        <label for="rentalEndDate" class="label-text">End Date:</label>
                        <input type="date" id="rentalEndDate" class="input-field-flex" title="The date when rental income/saving ended.">
                        <label class="checkbox-label">
                            <input type="checkbox" id="isRentalEndDateToday" class="form-checkbox">
                            <span class="ml-1">Select Today</span>
                        </label>
                    </div>
                </div>

                <div class="mt-4 mb-4">
                    <span class="label-text">Annual Rent Increase:</span>
                    <div class="radio-group">
                        <label class="radio-label" title="No annual increase in rent.">
                            <input type="radio" name="rentIncreaseType" value="none" class="form-radio" checked>
                            <span class="ml-2">None</span>
                        </label>
                        <label class="radio-label" title="Increase rent by a fixed amount each year.">
                            <input type="radio" name="rentIncreaseType" value="amount" class="form-radio">
                            <span class="ml-2">By Amount</span>
                        </label>
                        <label class="radio-label" title="Increase rent by a percentage each year.">
                            <input type="radio" name="rentIncreaseType" value="percent" class="form-radio">
                            <span class="ml-2">By Percent</span>
                        </label>
                    </div>
                </div>

                <div id="rentIncreaseValueContainer" class="hidden">
                    <label id="rentIncreaseValueLabel" for="rentIncreaseValue" class="label-text">Increase Value:</label>
                    <input type="number" id="rentIncreaseValue" class="input-field" placeholder="e.g., 1000 (amount) or 5 (for 5%)" title="The amount or percentage by which rent increases annually. Applied at the start of each calendar year after the rental start date.">
                </div>
            </div>
        </section>

        <section class="section-container orange-border">
            <h2 class="section-title orange-text">Recurring Expenses</h2>
            <div class="mb-4">
                <span class="label-text">Do you have recurring expenses?</span>
                <div class="radio-group">
                    <label class="radio-label" title="Select if you have ongoing expenses for the asset (e.g., maintenance, property tax).">
                        <input type="radio" name="hasRecurringExpenses" value="yes" class="form-radio">
                        <span class="ml-2">Yes</span>
                    </label>
                    <label class="radio-label" title="Select if you do not have recurring expenses.">
                        <input type="radio" name="hasRecurringExpenses" value="no" class="form-radio" checked>
                        <span class="ml-2">No</span>
                    </label>
                </div>
            </div>

            <div id="recurringExpensesDetailsSection" class="hidden">
                <div class="grid-2-cols mb-4">
                    <div>
                        <label for="recurringExpenseAmount" class="label-text">Expense Amount (₹):</label>
                        <input type="number" id="recurringExpenseAmount" class="input-field" placeholder="e.g., 5000" title="The amount of your recurring expense.">
                    </div>
                    <div>
                        <label for="recurringExpenseFrequency" class="label-text">Frequency:</label>
                        <select id="recurringExpenseFrequency" class="input-field" title="How often the expense occurs (monthly or annually).">
                            <option value="monthly">Monthly</option>
                            <option value="annually">Annually</option>
                        </select>
                    </div>
                    <div>
                        <label for="recurringExpenseStartDate" class="label-text">Start Date:</label>
                        <input type="date" id="recurringExpenseStartDate" class="input-field" title="The date when the recurring expenses began.">
                    </div>
                    <div>
                        <label for="recurringExpenseEndDate" class="label-text">End Date:</label>
                        <input type="date" id="recurringExpenseEndDate" class="input-field" title="The date when the recurring expenses ended.">
                    </div>
                </div>
            </div>
        </section>

        <section class="section-container gray-border">
            <h2 class="section-title gray-text">Inflation Details</h2>
            <div>
                <label for="inflationRate" class="label-text">Average Annual Inflation Rate (%):</label>
                <input type="number" id="inflationRate" class="input-field" placeholder="e.g., 6 (for 6% inflation)" title="Your assumed average annual inflation rate. Used to calculate real (inflation-adjusted) returns.">
            </div>
        </section>

        <section class="section-container purple-border">
            <h2 class="section-title purple-text">Asset Sale Details</h2>
            <div class="grid-2-cols">
                <div>
                    <label for="saleDate" class="label-text">Sale Date:</label>
                    <input type="date" id="saleDate" class="input-field" title="The date you plan to sell or have sold the asset.">
                </div>
                <div>
                    <label for="salePrice" class="label-text">Sale Price (₹):</label>
                    <input type="number" id="salePrice" class="input-field" placeholder="e.g., 15000000 (1.5 Crores)" title="The price at which the asset is sold in Indian Rupees.">
                </div>
            </div>
        </section>

        <section class="section-container red-border">
            <h2 class="section-title red-text">Taxation Details</h2>
            <div class="grid-1-col">
                <div>
                    <label for="estimatedCapitalGainsTax" class="label-text">Estimated Capital Gains Tax on Sale (₹):</label>
                    <input type="number" id="estimatedCapitalGainsTax" class="input-field" placeholder="e.g., 500000" title="Your estimated capital gains tax liability from the sale of the asset. This amount will be treated as an outflow.">
                </div>
            </div>
            <p class="text-sm-note mt-2">
                * This calculator now allows you to directly input your estimated capital gains tax.
                * Any other taxes (e.g., rental income tax) should be included in the 'Recurring Expenses' section if you wish to account for them.
                * This calculation is a simplified estimate and not tax advice.
            </p>
        </section>

        <div class="text-center mb-8">
            <button id="calculateButton" class="button-primary">
                Calculate Summary
            </button>
        </div>

        <section id="resultsSection" class="section-container results-section hidden">
            <h2 class="section-title gray-text">Financial Summary</h2>

            <div class="chart-container">
                <h3 class="chart-title">Overall Cash Flow Overview</h3>
                <div class="flex-col-gap-2">
                    <div class="flex-align-center">
                        <span class="w-24 text-sm font-medium">Inflows:</span>
                        <div class="relative flex-grow h-6 bg-green-200 rounded-r-md">
                            <div id="inflowsBar" class="bg-green-600 h-full rounded-r-md" style="width: 0%;"></div>
                            <span id="inflowsText" class="absolute-text-chart"></span>
                        </div>
                    </div>
                    <div class="flex-align-center">
                        <span class="w-24 text-sm font-medium">Outflows:</span>
                        <div class="relative flex-grow h-6 bg-red-200 rounded-r-md">
                            <div id="outflowsBar" class="bg-red-600 h-full rounded-r-md" style="width: 0%;"></div>
                            <span id="outflowsText" class="absolute-text-chart"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-3 mb-6">
                <p class="text-lg">
                    <span class="font-medium">Total Spend (Outflows): </span>
                    <span id="totalSpendDisplay" class="font-bold text-red-600"></span>
                </p>
                <ul id="outflowDetails" class="list-disc-styled ml-4 text-gray-700 text-md"></ul>

                <p class="text-lg mt-4">
                    <span class="font-medium">Total Earned (Inflows): </span>
                    <span id="totalEarnedDisplay" class="font-bold text-green-600"></span>
                </p>
                <ul id="inflowDetails" class="list-disc-styled ml-4 text-gray-700 text-md"></ul>

                <p class="text-lg mt-4">
                    <span class="font-medium">Nominal Remaining Profit/Loss: </span>
                    <span id="nominalProfitLossDisplay" class="font-bold"></span>
                </p>
                <p class="text-lg">
                    <span class="font-medium">Real Remaining Profit/Loss (Inflation-Adjusted): </span>
                    <span id="realProfitLossDisplay" class="font-bold"></span>
                </p>
                <p class="text-lg">
                    <span class="font-medium">Nominal XIRR (Annualized): </span>
                    <span id="nominalXirrResultDisplay" class="font-bold text-indigo-600"></span>
                </p>
                <p class="text-lg">
                    <span class="font-medium">Real XIRR (Annualized): </span>
                    <span id="realXirrResultDisplay" class="font-bold text-indigo-600"></span>
                </p>
            </div>

            <div id="amortizationScheduleSection" class="mt-8 p-4 bg-blue-50 rounded-lg border border-blue-200 hidden">
                <h3 class="section-title-sub blue-text">Loan Amortization Schedule</h3>
                <div class="overflow-x-auto max-h-96">
                    <table class="table-styled">
                        <thead>
                            <tr class="table-header-row blue-bg-header">
                                <th class="table-header-cell">Month</th>
                                <th class="table-header-cell">Date</th>
                                <th class="table-header-cell text-right">EMI (₹)</th>
                                <th class="table-header-cell text-right">Principal Paid (₹)</th>
                                <th class="table-header-cell text-right">Interest Paid (₹)</th>
                                <th class="table-header-cell text-right">Remaining Balance (₹)</th>
                            </tr>
                        </thead>
                        <tbody id="amortizationScheduleBody">
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="cashFlowsSection" class="mt-6 hidden">
                <h3 class="section-title-sub flex-align-center gray-text">
                    Generated Cash Flows (for XIRR):
                    <button id="exportCsvButton" class="button-export" title="Download a CSV file of all detailed cash flows.">
                        Export to Excel (CSV)
                    </button>
                </h3>
                <div class="overflow-x-auto max-h-96">
                    <table class="table-styled">
                        <thead>
                            <tr class="table-header-row gray-bg-header">
                                <th class="table-header-cell">Date</th>
                                <th class="table-header-cell">Amount (₹)</th>
                                <th class="table-header-cell">Description</th>
                            </tr>
                        </thead>
                        <tbody id="cashFlowsTableBody">
                            </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>

    <script src="script.js"></script>
</body>
</html>